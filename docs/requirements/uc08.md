# UC-08 Оформление заказа

### Предусловия

1. Кассовый день открыт.
2. Пользователь авторизован или не авторизован в системе.
3. В корзине добавлено хотя бы одно блюдо.
4. Пользователь находится в корзине.

### Постусловия

1. Заказ оформлен.

### Основной сценарий

1. Пользователь нажимает кнопку «Оформить заказ».
2. Система отображает экран оформления заказа. Все блюда из корзины отображаются в заказе.
3. Пользователь указывает/изменяет:
    1. способ получения заказа (в зале / навынос),
    2. время получения заказа (как можно скорее / к определенному времени),
    3. способ оплаты заказа (банковской картой / наличными при получении),
    4. списать или копить баллы программы лояльности (если пользователь авторизован и на его счету есть бонусы): если 
       пользователь выбирает списать бонусы, то сумма заказа сразу пересчитывается.
    5. свои контактные данные (если пользователь авторизован, данные подтягиваются из его профиля).
4. Если пользователь выбрал способ оплаты «банковской картой», то он нажимает кнопку «Оплатить заказ».
5. Система проверяет наличие заказанных блюд и ингредиентов. Все блюда и ингредиенты доступны.
6. Выполняется сценарий **[UC-09 Оплата заказа картой](uc09.md)**.
7. Система сохраняет данные заказа, формирует номер заказа, присваивает заказу статус «Создан».
8. Система отправляет в сервис управления роботами информацию, что создан новый заказ.
9. Система информирует пользователя об успешной оплате, отображает номер, штрих-код и статус заказа на устройстве 
   пользователя и на табло в зале.

### Альтернативные сценарии

2а. Система отображает экран оформления заказа. Если пользователь не авторизован, система предлагает подключиться к программе лояльности.

1. Пользователь хочет подключиться/войти в программу лояльности:
    1. Выполняется сценарий **[UC-01 Регистрация в программе лояльности](uc01.md)**.
    2. Выполняется **основной сценарий**, начиная с шага 2.
2. Пользователь не хочет подключиться/войти в программу лояльности:
    1. Выполняется **основной сценарий**, начиная с шага 3.

4а. Пользователь выбрал «Наличными при получении».

1. Пользователь нажимает кнопку «Оформить заказ».
2. Выполняется **основной сценарий**, начиная с шага 7.

5а. Система проверяет наличие заказанных блюд и ингредиентов. Одно или несколько блюд или ингредиентов НЕдоступны.

1. Система выводит уведомление, что часть блюд стали недоступны для заказа, и предлагает сделать замену или удалить блюдо из заказа.
2. Пользователь выбирает заменить блюдо.
3. Система отображает меню ресторана. Выполняются **сценарии [UC-03 Просмотр меню](uc03.md), [UC-04 Просмотр карточки блюда](uc04.md), 
   [UC-05 Добавление блюда в корзину](uc05.md)**.
4. Система заменяет недоступное блюдо выбранным.
5. Выполняется **основной сценарий**, начиная с шага 2.

5а2а. Пользователь выбирает удалить блюдо.

1. Система удаляет недоступное блюдо из корзины.
2. Выполняется **основной сценарий**, начиная с шага 2.

### Исключения

Прерывание процесса:

1. Пользователь покидает экран оформления заказа любым доступным ему способом на любом из шагов.
2. Заказ не создается.

*Пользователь может вернуться на экран оформления заказа только через повторный запуск основного сценария из корзины.*


