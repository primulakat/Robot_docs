# UC-08 Оформление заказа

### Предусловия

1. Кассовый день открыт.
2. Пользователь авторизован или не авторизован в системе.
3. В корзине добавлено хотя бы одно блюдо.
4. Пользователь находится в корзине.

### Постусловия

1. Заказ оформлен.

### Основной сценарий

1. Пользователь нажимает кнопку «Перейти к оформлению».
2. Система отображает экран оформления заказа. Все блюда из корзины отображаются в заказе.
3. Пользователь указывает/изменяет:
    1. свои контактные данные (если пользователь авторизован, данные подтягиваются из его профиля),
    2. способ получения заказа (в зале / навынос),
    3. время получения заказа (сразу / к определенному времени),
    4. способ оплаты заказа (банковской картой / наличными при получении),
    5. списать или копить бонусы программы лояльности (если пользователь авторизован и на его счету есть бонусы): если пользователь выбирает списать бонусы, то сумма заказа сразу пересчитывается.
4. Если пользователь выбрал «Оплата банковской картой», то он нажимает кнопку «Оплатить заказ».
5. Система проверяет наличие заказанных блюд и ингредиентов. Все блюда и ингредиенты доступны.
6. Выполняется сценарий **[UC-09 Оплата заказа картой](uc09.md).**
7. Система сохраняет данные заказа, формирует номер заказа, присваивает заказу статус «Создан».
8. Система отправляет в сервис управления роботами информацию, что создан новый заказ.
9. Система информирует пользователя об успешной оплате, отображает номер заказа на устройстве пользователя и на табло в зале.

### Альтернативные сценарии

2а. Система отображает экран оформления заказа. Если пользователь не авторизован, система предлагает подключиться к программе лояльности.

1. Если пользователь еще не зарегистрирован и хочет подключиться к программе лояльности, то:
    1. Пользователь нажимает кнопку «Подключиться».
    2. Выполняется сценарий **[UC-01 Регистрация в программе лояльности](uc01.md)**.
    3. Выполняется **основной сценарий**, начиная с шага 2.
2. Если пользователь уже зарегистрирован и хочет авторизоваться в системе, то:
    1. Пользователь нажимает кнопку «Войти».
    2. Выполняется сценарий **[UC-02 Авторизация в программе лояльности](uc02.md)**.
    3. Выполняется **основной сценарий**, начиная с шага 2.
3. Если пользователь не хочет подключаться к программе / авторизоваться в системе, то:
    1. Альтернативный сценарий пропускается. Выполняется **основной сценарий**, начиная с шага 3.

4а. Пользователь выбрал «Наличными при получении».

1. Пользователь нажимает кнопку «Оформить заказ».
2. Выполняется **основной сценарий**, начиная с шага 7.

5а. Система проверяет наличие заказанных блюд и ингредиентов. Одно или несколько блюд или ингредиентов НЕдоступны.

1. Система выводит уведомление, что часть блюд стали недоступны для заказа, и предлагает сделать замену или удалить блюдо из заказа.
2. Пользователь выбирает заменить блюдо.
3. Система отображает меню ресторана. Выполняются **сценарии [UC-03 Просмотр меню](uc03.md), [UC-04 Просмотр карточки блюда](uc04.md), 
   [UC-05 Добавление блюда в корзину](uc05.md)**.
4. Система заменяет недоступное блюдо выбранным.
5. Выполняется **основной сценарий**, начиная с шага 2.

5а2а. Пользователь выбирает удалить блюдо.

1. Система удаляет недоступное блюдо из корзины.
2. Выполняется **основной сценарий**, начиная с шага 2.

### Исключения

Прерывание процесса:

1. Пользователь покидает экран оформления заказа любым доступным ему способом на любом из шагов.
2. Заказ не создается.

*Пользователь может вернуться на экран оформления заказа только через повторный запуск основного сценария из корзины.*


